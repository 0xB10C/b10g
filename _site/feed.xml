<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.6.2">Jekyll</generator><link href="http://localhost:4000/feed.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:4000/" rel="alternate" type="text/html" /><updated>2018-02-22T20:44:55+01:00</updated><id>http://localhost:4000/</id><title type="html">b10c</title><subtitle>bitcoin enthusiast from germany</subtitle><entry><title type="html">The 300MB default maxmempool Problem</title><link href="http://localhost:4000/The-300MB-default-maxmempool-problem/" rel="alternate" type="text/html" title="The 300MB default maxmempool Problem" /><published>2017-12-18T16:16:16+01:00</published><updated>2017-12-18T16:16:16+01:00</updated><id>http://localhost:4000/The-300MB-default-maxmempool-problem</id><content type="html" xml:base="http://localhost:4000/The-300MB-default-maxmempool-problem/">&lt;p class=&quot;text-justify&quot;&gt;Unconfirmed transaction are quite a hassle for bitcoin users.
I recently came across an interesting problem which is not the usual “my transaction is stuck” problem.&lt;/p&gt;

&lt;p class=&quot;text-justify&quot;&gt;In the last weeks of 2017 the number of unconfirmed transactions has again reached all time highs.
Periods with over 100k transactions in my mempool where not unusal.
Bitcoin Core limits the system memory allocated for storing unconfirmed transactions to 300MB by default.
This serves as an anti-DoS feature.
Fully used 300MB of RAM equal about 110MB of actual raw transaction data.
This default value &lt;a href=&quot;https://en.bitcoin.it/wiki/Running_Bitcoin&quot;&gt;can be changed&lt;/a&gt; with the &lt;code class=&quot;highlighter-rouge&quot;&gt;-maxmempool &amp;lt;n&amp;gt;&lt;/code&gt; option where &lt;code class=&quot;highlighter-rouge&quot;&gt;n&lt;/code&gt; is the amount of megabytes allocated to store unconfirmed transactions.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;bitcoin-cli getmempoolinfo
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;s2&quot;&gt;&quot;size&quot;&lt;/span&gt;: 123803,               &lt;span class=&quot;c&quot;&gt;# amount of tx&lt;/span&gt;
  &lt;span class=&quot;s2&quot;&gt;&quot;bytes&quot;&lt;/span&gt;: 107840125,           &lt;span class=&quot;c&quot;&gt;# raw tx bytes&lt;/span&gt;
  &lt;span class=&quot;s2&quot;&gt;&quot;usage&quot;&lt;/span&gt;: 298526272,           &lt;span class=&quot;c&quot;&gt;# tx in ram bytes&lt;/span&gt;
  &lt;span class=&quot;s2&quot;&gt;&quot;maxmempool&quot;&lt;/span&gt;: 300000000,      &lt;span class=&quot;c&quot;&gt;# maxmempool in bytes&lt;/span&gt;
  &lt;span class=&quot;s2&quot;&gt;&quot;mempoolminfee&quot;&lt;/span&gt;: 0.00016486   &lt;span class=&quot;c&quot;&gt;# min tx-fee to get accepted&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p class=&quot;text-justify&quot;&gt;Once 300MB of system memory are reached, Bitcoin  Core starts dropping low-feerate transactions from the mempool for high-feerate transactions.
Additionally a &lt;em&gt;mempoolminfee&lt;/em&gt;-threshold is set to prevent new low fee transactions from entering the mempool.&lt;/p&gt;

&lt;p style=&quot;text-align: center; margin-bottom:40px;&quot;&gt;&lt;img src=&quot;/images/2017-12-18/transactions-dropping-from-mempool.png&quot; alt=&quot;chained mempool transactions&quot; /&gt;
Transactions dropping from mempool - &lt;a href=&quot;https://mempool.observer/#size-7d&quot;&gt;https://mempool.observer&lt;/a&gt;&lt;/p&gt;

&lt;p class=&quot;text-justify&quot;&gt;A node operator can increase or decrease the &lt;em&gt;maxmempool&lt;/em&gt; option to better fit their system.
I assume that for example some blockexplorers have increased their &lt;em&gt;maxmempool&lt;/em&gt;.
I know that Jochen Hoenicke for example has an node running with a &lt;a href=&quot;https://www.reddit.com/r/Bitcoin/comments/7i6rnu/why_is_no_one_talking_about_the_178000/dqx5osf/&quot;&gt;&lt;em&gt;maxmempool&lt;/em&gt; of 2GB&lt;/a&gt;.&lt;/p&gt;

&lt;h1 id=&quot;the-problem&quot;&gt;The Problem&lt;/h1&gt;
&lt;p class=&quot;text-justify&quot;&gt;Small differences in the mempool are common.
However with an increased &lt;em&gt;maxmempool&lt;/em&gt; a nodes mempool can differ vastly from a majority of other nodes on the network.
These nodes, especially when they power a blockexplorer, still many keep unconfirmed transactions the majority of the network has already dropped.
This can be irritating for users.&lt;/p&gt;

&lt;p class=&quot;text-justify&quot;&gt;I came a cross a particular form of this problem, when a friend asked me, why he can see a certain low-fee transaction on &lt;a href=&quot;https://bitaps.com&quot;&gt;bitaps.com&lt;/a&gt;, but not on &lt;a href=&quot;https://blockchain.info&quot;&gt;blockchain.info&lt;/a&gt;.
My local node, with a default 300MB &lt;em&gt;maxmempool&lt;/em&gt;, responded with an error on calling the &lt;em&gt;getrawtransaction&lt;/em&gt; RPC with the txid.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;bitcoin-cli getrawtransaction &amp;lt;txid&amp;gt;
error code: &lt;span class=&quot;nt&quot;&gt;-5&lt;/span&gt;
error message:
No such mempool transaction.&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p class=&quot;text-justify&quot;&gt;However using the &lt;a href=&quot;https://bitaps.com&quot;&gt;bitaps.com&lt;/a&gt; API to query the raw transaction worked fine.
I tried rebroadcasting the raw transaction with &lt;em&gt;sendrawtransaction&lt;/em&gt;.
This failed.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;bitcoin-cli sendrawtransaction &amp;lt;rawtx&amp;gt;
error code: &lt;span class=&quot;nt&quot;&gt;-25&lt;/span&gt;
error message:
Missing inputs&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p class=&quot;text-justify&quot;&gt;Looking at the missing input I noticed that it references a unconfirmed change output from an transaction with equally low fees.
However I again wasn’t able to find the parent transaction for the input in my local mempool or on &lt;a href=&quot;https://blockchain.info&quot;&gt;blockchain.info&lt;/a&gt;.
Only &lt;a href=&quot;https://bitaps.com&quot;&gt;bitaps.com&lt;/a&gt; had it.
And this transaction again referenced an unconfirmed low-fee output as an input.&lt;/p&gt;

&lt;p&gt;With the context of the &lt;em&gt;maxmempool&lt;/em&gt; limit this started to make sense.&lt;/p&gt;

&lt;h1 id=&quot;my-guess-on-what-happened&quot;&gt;My guess on what happened&lt;/h1&gt;

&lt;p class=&quot;text-justify&quot;&gt;My guess on what happened is, that &lt;a href=&quot;https://bitaps.com&quot;&gt;bitaps.com&lt;/a&gt; has an higher &lt;em&gt;maxmempool&lt;/em&gt;-limit than e.g. &lt;a href=&quot;https://blockchain.info&quot;&gt;blockchain.info&lt;/a&gt; and therefore does not drop the transactions.
A user checking &lt;a href=&quot;https://bitaps.com&quot;&gt;bitaps.com&lt;/a&gt; sees the transaction, a user checking &lt;a href=&quot;https://blockchain.info&quot;&gt;blockchain.info&lt;/a&gt; doesn’t.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/2017-12-18/chained-mempool-tx.png&quot; alt=&quot;chained mempool transactions&quot; /&gt;&lt;/p&gt;

&lt;p class=&quot;text-justify&quot;&gt;The real issue appears when the original sender is not aware of this and has a peer with a larger-than-default mempool.
He unknowingly continues to chain transactions to a unconfirmed parent transaction that the vast majority of the network rejects.
The broadcasted transaction spends an output which references a dropped transaction and therefore is invalid.&lt;/p&gt;

&lt;h1 id=&quot;a-solution&quot;&gt;A Solution&lt;/h1&gt;

&lt;p&gt;A Solution might simply be:&lt;/p&gt;

&lt;p style=&quot;text-align: center; margin-bottom:10px;&quot;&gt;&lt;strong&gt;Pay more fees if you want to make sure your transactions don’t get dropped.&lt;/strong&gt;&lt;/p&gt;

&lt;p class=&quot;text-justify&quot;&gt;And maybe consider doing some sort of checking if you create long chains of unconfirmed low-fee transactions.
To temporarily fix this one could rebroadcast all dropped transactions in the correct order hoping that they don’t get dropped again.&lt;/p&gt;

&lt;h2 id=&quot;addendum-20180210&quot;&gt;Addendum 2018/02/10:&lt;/h2&gt;
&lt;p class=&quot;text-justify&quot;&gt;As David Harding &lt;a href=&quot;https://twitter.com/hrdng/status/955492510998069249&quot;&gt;points out&lt;/a&gt; the sender could use &lt;a href=&quot;https://github.com/bitcoin/bips/blob/master/bip-0125.mediawiki&quot;&gt;BIP125 ReplaceByFee&lt;/a&gt; to update a unconfirmed transaction with new outputs.&lt;/p&gt;

&lt;div class=&quot;jekyll-twitter-plugin&quot;&gt;&lt;blockquote class=&quot;twitter-tweet&quot;&gt;&lt;p lang=&quot;en&quot; dir=&quot;ltr&quot;&gt;An alternative solution for the original sender is to use BIP125 RBF to update his first unconfirmed transaction with new outputs rather than creating additional new transactions.  This is more efficient and so requires less overall fee, and it avoids the problem you identified.&lt;/p&gt;&amp;mdash; David A. Harding [NO176] (@hrdng) &lt;a href=&quot;https://twitter.com/hrdng/status/955492510998069249?ref_src=twsrc%5Etfw&quot;&gt;January 22, 2018&lt;/a&gt;&lt;/blockquote&gt;
&lt;script async=&quot;&quot; src=&quot;https://platform.twitter.com/widgets.js&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt;
&lt;/div&gt;</content><author><name>b10c</name></author><summary type="html">Unconfirmed transaction are quite a hassle for bitcoin users. I recently came across an interesting problem which is not the usual “my transaction is stuck” problem.</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/images/2017-12-18/transactions-dropping-from-mempool.png" /></entry></feed>